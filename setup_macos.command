#!/bin/bash

# Anicard Auto - Complete macOS Setup
# –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è macOS 10.15+

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫—É UTF-8
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8

# –ü–æ–ª—É—á–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–∞
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

echo "=========================================="
echo "  Anicard Auto - –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ macOS"
echo "=========================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é macOS
echo "üçé –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é macOS..."
macos_version=$(sw_vers -productVersion)
echo "‚úÖ macOS –≤–µ—Ä—Å–∏—è: $macos_version"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–µ—Ä—Å–∏—è 10.15 –∏–ª–∏ –≤—ã—à–µ
if [[ $(echo "$macos_version" | cut -d. -f1) -lt 10 ]] || [[ $(echo "$macos_version" | cut -d. -f2) -lt 15 ]]; then
    echo "‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è macOS 10.15 –∏–ª–∏ –≤—ã—à–µ"
    echo "   –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: $macos_version"
    echo ""
fi

# –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
echo "üîß –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞..."
chmod +x *.command
if [ $? -eq 0 ]; then
    echo "‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞"
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤—ã—Ö–æ–¥–∞..."
    exit 1
fi

# –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ Python
echo ""
echo "üêç –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ Python..."
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python 3 –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.x."
    echo "   (https://www.python.org/downloads/)"
    echo ""
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤—ã—Ö–æ–¥–∞..."
    exit 1
fi

PYTHON_VERSION=$(python3 -c "import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')")
echo "‚úÖ Python –≤–µ—Ä—Å–∏—è: $PYTHON_VERSION"

# –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo ""
echo "üì¶ –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
if [ -f "requirements.txt" ]; then
    pip3 install -r requirements.txt
    if [ $? -eq 0 ]; then
        echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
        read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤—ã—Ö–æ–¥–∞..."
        exit 1
    fi
else
    echo "‚ùå –§–∞–π–ª requirements.txt –Ω–µ –Ω–∞–π–¥–µ–Ω"
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤—ã—Ö–æ–¥–∞..."
    exit 1
fi

# –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git
echo ""
echo "üîß –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git..."
if ! command -v git &> /dev/null; then
    echo "‚ùå Git –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Git."
    echo "   (https://git-scm.com/downloads)"
    echo ""
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤—ã—Ö–æ–¥–∞..."
    exit 1
fi

echo "‚úÖ Git –Ω–∞–π–¥–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º
if [ ! -d ".git" ]; then
    echo "‚ÑπÔ∏è Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
    echo "   –ó–∞–ø—É—Å—Ç–∏—Ç–µ setup_git.command –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Git"
else
    echo "‚úÖ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
fi

# –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–ø–æ–∫
echo ""
echo "üìÅ –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–ø–æ–∫..."
mkdir -p accounts/cards
mkdir -p errors
mkdir -p scripts/errors

if [ $? -eq 0 ]; then
    echo "‚úÖ –ü–∞–ø–∫–∏ —Å–æ–∑–¥–∞–Ω—ã"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–∞–ø–æ–∫"
fi

# –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo ""
echo "‚öôÔ∏è –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º .env
if [ -f ".env" ]; then
    echo "‚úÖ –§–∞–π–ª .env –Ω–∞–π–¥–µ–Ω"
else
    echo "‚ö†Ô∏è –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ —Å–æ–≥–ª–∞—Å–Ω–æ README"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º accounts.json
if [ -f "accounts/accounts.json" ]; then
    echo "‚úÖ –§–∞–π–ª accounts.json –Ω–∞–π–¥–µ–Ω"
else
    echo "‚ö†Ô∏è –§–∞–π–ª accounts.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∞–∫–∫–∞—É–Ω—Ç–æ–≤"
fi

# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
echo ""
echo "=========================================="
echo "  –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "=========================================="
echo ""
echo "üéØ –ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:"
echo ""
echo "1. üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã:"
echo "   - –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ start_macos.command"
echo "   - –ò–ª–∏: python3 main.py"
echo ""
echo "2. üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git (–µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω):"
echo "   - –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ setup_git.command"
echo ""
echo "3. üåø –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:"
echo "   - –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ create_hidden_branch.command"
echo ""
echo "4. üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º:"
echo "   - –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ sync_server.command"
echo "   - –ò–ª–∏: auto_sync.command –¥–ª—è –≤—Å–µ—Ö –≤–µ—Ç–æ–∫"
echo ""
echo "5. üë§ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤:"
echo "   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç 8"
echo ""
echo "üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
echo "   - README.md - –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"
echo "   - README_macOS.md - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è macOS"
echo ""
echo "üéâ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ!"
echo ""
read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤—ã—Ö–æ–¥–∞..."

